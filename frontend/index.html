<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FrostDAO - FROST Threshold Signatures</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <h1>FrostDAO</h1>
        <p class="subtitle">FROST Threshold Signatures for Bitcoin</p>

        <!-- Main Tabs -->
        <div class="main-tabs">
            <button class="main-tab active" onclick="switchMainTab('dkg')">DKG <span class="tab-badge frost">FROST</span></button>
            <button class="main-tab" onclick="switchMainTab('htss')">HTSS <span class="tab-badge frost">FROST</span></button>
            <button class="main-tab" onclick="switchMainTab('sign')">Sign <span class="tab-badge btc">BTC</span></button>
            <button class="main-tab" onclick="switchMainTab('hd')">HD Addresses <span class="tab-badge new">BIP44</span></button>
            <button class="main-tab" onclick="switchMainTab('reshare')">Reshare</button>
            <button class="main-tab" onclick="switchMainTab('backup')">Backup</button>
            <button class="main-tab" onclick="switchMainTab('verify')">Verify</button>
        </div>

        <!-- DKG Tab -->
        <div id="dkg-content" class="main-tab-content active">
            <p class="subtitle">Distributed Key Generation - Standard FROST</p>
            <div class="card">
                <div class="section-title">What is DKG?</div>
                <p style="color: #aaa; line-height: 1.8;">Distributed Key Generation creates a shared public key where no single party knows the private key. Each party holds a secret share, and <strong>t-of-n</strong> parties can collaborate to sign.</p>
                <div class="feature-grid">
                    <div class="feature-card"><h4>2-of-3</h4><p>Any 2 of 3 parties can sign</p></div>
                    <div class="feature-card"><h4>3-of-5</h4><p>Any 3 of 5 parties can sign</p></div>
                    <div class="feature-card"><h4>5-of-7</h4><p>Any 5 of 7 parties can sign</p></div>
                </div>
            </div>

            <!-- Nostr Config -->
            <div class="config-section">
                <div class="config-header">
                    <span class="status-indicator" id="dkg-status-indicator"></span>
                    <span>Coordination Room</span>
                    <span id="dkg-status-text" style="margin-left: auto; font-size: 0.8em; color: #888;">Disconnected</span>
                </div>
                <div class="config-grid">
                    <div class="config-field"><label>Room ID</label><input type="text" id="dkg-room-id" value="frostdao-demo"></div>
                    <div class="config-field"><label>Threshold (t)</label><input type="number" id="dkg-threshold" value="2" min="1"></div>
                    <div class="config-field"><label>Parties (n)</label><input type="number" id="dkg-n-parties" value="3" min="1"></div>
                    <div class="config-field"><label>My Index</label><input type="number" id="dkg-my-index" value="1" min="1"></div>
                </div>
                <button class="btn btn-primary" onclick="dkgUpdateConfig()">Subscribe to Room</button>
                <button class="btn btn-secondary" onclick="dkgClearAll()" style="margin-left: 10px;">Clear</button>
            </div>

            <div class="warning">All parties must use the same Room ID, threshold, and n_parties values!</div>

            <!-- E2E Encryption -->
            <div class="config-section" style="border: 1px solid rgba(46, 204, 113, 0.3); background: rgba(46, 204, 113, 0.05);">
                <div class="config-header">
                    <span class="status-indicator" id="dkg-encryption-indicator"></span>
                    <span style="color: #2ecc71;">E2E Encryption (NIP-44)</span>
                    <span id="dkg-encryption-status" style="margin-left: auto; font-size: 0.8em; color: #888;">Not configured</span>
                </div>
                <p style="color: #888; font-size: 12px; margin-bottom: 12px;">Enter your secret coefficient (a₀) from Round 1 CLI output.</p>
                <div class="config-grid">
                    <div class="config-field" style="grid-column: span 3;">
                        <label>My Secret Coefficient (a₀) - 64 hex chars</label>
                        <input type="password" id="dkg-secret-coefficient" placeholder="64 hex characters..." style="font-family: monospace;">
                    </div>
                </div>
                <button class="btn btn-success" onclick="enableDkgEncryption()">Enable E2E Encryption</button>
                <span id="dkg-encryption-keys-count" style="margin-left: 12px; font-size: 12px; color: #888;"></span>
            </div>

            <h2 class="section-header">DKG Protocol</h2>

            <!-- Round 1 -->
            <div class="phase-section">
                <div class="phase-header"><div class="phase-title">Round 1: Generate Commitments</div><div class="phase-count" id="dkg-round1-count">0 / 0</div></div>
                <div class="post-box">
                    <div class="post-label">Run: <code>frostdao dkg-round1 --threshold 2 --n-parties 3 --my-index 1</code></div>
                    <textarea class="post-textarea" id="dkg-round1-input" placeholder='Paste round1 JSON...'></textarea>
                    <button class="btn" onclick="postToNostr('dkg-round1-input', 'keygen_round1', 'dkg')">Broadcast</button>
                </div>
                <div class="entries-container" id="dkg-round1-entries"><div class="empty-state">Waiting...</div></div>
                <div class="copy-section" id="dkg-round1-copy-section"><div class="copy-label">All Commitments</div><div class="copy-output" id="dkg-round1-output"></div><button class="btn btn-secondary" onclick="copyToClipboard('dkg-round1-output')">Copy</button></div>
            </div>

            <!-- Round 2 -->
            <div class="phase-section">
                <div class="phase-header"><div class="phase-title">Round 2: Secret Shares</div><div class="phase-count" id="dkg-round2-count">0 / 0</div></div>
                <div class="post-box">
                    <div class="post-label">Run: <code>frostdao dkg-round2 --data '&lt;commitments&gt;'</code></div>
                    <textarea class="post-textarea" id="dkg-round2-input" placeholder='Paste round2 JSON...'></textarea>
                    <button class="btn" onclick="postToNostr('dkg-round2-input', 'keygen_round2', 'dkg')">Broadcast</button>
                </div>
                <div class="entries-container" id="dkg-round2-entries"><div class="empty-state">Waiting...</div></div>
                <div class="copy-section" id="dkg-round2-copy-section"><div class="copy-label">All Shares</div><div class="copy-output" id="dkg-round2-output"></div><button class="btn btn-secondary" onclick="copyToClipboard('dkg-round2-output')">Copy</button></div>
            </div>

            <!-- Finalize -->
            <div class="phase-section">
                <div class="phase-header"><div class="phase-title">Finalize: Generate Keys</div></div>
                <div class="post-box">
                    <div class="post-label">Run: <code>frostdao dkg-finalize --data '&lt;all-shares&gt;'</code></div>
                    <p style="color: #888; font-size: 13px;">This generates your secret share and the group's Bitcoin address!</p>
                </div>
            </div>
        </div>

        <!-- HTSS Tab -->
        <div id="htss-content" class="main-tab-content">
            <p class="subtitle">Hierarchical Threshold Signature Scheme - FROST with Ranks</p>
            <div class="card">
                <div class="section-title">What is HTSS?</div>
                <p style="color: #aaa;">HTSS extends FROST with <strong>hierarchical ranks</strong>. Higher-ranked parties have more signing authority.</p>
                <div style="margin-top: 12px;"><span class="rank-badge rank-0">Rank 0 - CEO</span> <span class="rank-badge rank-1">Rank 1 - CFO</span> <span class="rank-badge rank-2">Rank 2 - Director</span></div>
            </div>
            <div class="config-section">
                <div class="config-header"><span class="status-indicator" id="htss-status-indicator"></span><span>HTSS Config</span><span id="htss-status-text" style="margin-left: auto; color: #888;">Disconnected</span></div>
                <div class="config-grid">
                    <div class="config-field"><label>Room ID</label><input type="text" id="htss-room-id" value="htss-demo"></div>
                    <div class="config-field"><label>Threshold</label><input type="number" id="htss-threshold" value="3"></div>
                    <div class="config-field"><label>Parties</label><input type="number" id="htss-n-parties" value="5"></div>
                    <div class="config-field"><label>My Index</label><input type="number" id="htss-my-index" value="1"></div>
                    <div class="config-field"><label>My Rank</label><input type="number" id="htss-my-rank" value="0"></div>
                </div>
                <button class="btn btn-primary" onclick="htssUpdateConfig()">Subscribe</button>
            </div>
            <div class="phase-section">
                <div class="phase-header"><div class="phase-title">Round 1: Commitments</div><div class="phase-count" id="htss-round1-count">0 / 0</div></div>
                <div class="post-box"><textarea class="post-textarea" id="htss-round1-input" placeholder='Paste round1 JSON...'></textarea><button class="btn" onclick="postToNostr('htss-round1-input', 'keygen_round1', 'htss')">Broadcast</button></div>
                <div class="entries-container" id="htss-round1-entries"><div class="empty-state">Waiting...</div></div>
                <div class="copy-section" id="htss-round1-copy-section"><div class="copy-output" id="htss-round1-output"></div><button class="btn btn-secondary" onclick="copyToClipboard('htss-round1-output')">Copy</button></div>
            </div>
        </div>

        <!-- Sign Tab -->
        <div id="sign-content" class="main-tab-content">
            <p class="subtitle">Threshold Signing for Bitcoin Transactions</p>
            <h2 class="section-header">Private Signing Room (Nostr)</h2>
            <div class="config-section">
                <div class="config-header"><span>Private Room</span><span id="sign-room-status"><span id="sign-status-indicator" class="status-indicator"></span><span id="sign-status-text" style="margin-left:4px;">Not connected</span></span></div>
                <div class="config-grid">
                    <div class="config-field"><label>Room ID</label><input type="text" id="sign-room-id" placeholder="signing-room-001"></div>
                    <div class="config-field"><label>My Index</label><input type="number" id="sign-my-index" value="1"></div>
                    <div class="config-field"><label>Group Size</label><input type="number" id="sign-group-size" value="3"></div>
                    <div class="config-field" style="display:flex;align-items:flex-end;"><button class="btn" onclick="joinSigningRoom()">Join Room</button></div>
                </div>
            </div>
            <div class="config-section">
                <div class="config-header"><span>Group Encryption Keys</span><span id="sign-encryption-status" style="color:#ff6b6b;">Not configured</span></div>
                <div style="padding:16px;"><textarea id="sign-group-keys" placeholder="1:abc123...&#10;2:def456..." style="width:100%;height:60px;font-family:monospace;font-size:11px;"></textarea>
                <div style="margin-top:8px;"><label style="color:#888;font-size:12px;">My Secret (a₀)</label><input type="password" id="sign-my-secret" placeholder="64 hex chars" style="width:100%;margin-top:4px;"></div>
                <button class="btn btn-success" onclick="setupSigningEncryption()" style="margin-top:8px;">Enable Private Mode</button></div>
            </div>
            <div class="config-section"><div class="config-header"><span>Broadcast Nonce</span></div><div style="padding:12px;"><textarea id="sign-nonce-input" placeholder="Paste nonce JSON..." style="width:100%;height:50px;font-family:monospace;font-size:11px;"></textarea><button class="btn" onclick="broadcastEncryptedNonce()" style="margin-top:8px;">Broadcast</button></div></div>
            <div class="config-section"><div class="config-header"><span>Received Nonces</span><span id="sign-nonce-count" style="color:#00d4ff;">0 received</span></div><div style="padding:12px;" id="sign-received-nonces">No nonces yet.</div><button class="btn" onclick="copyCollectedNonces()" style="margin:12px;">Copy All Nonces</button></div>
            <div class="config-section"><div class="config-header"><span>Broadcast Signature Share</span></div><div style="padding:12px;"><textarea id="sign-share-input" placeholder="Paste share JSON..." style="width:100%;height:50px;font-family:monospace;font-size:11px;"></textarea><button class="btn" onclick="broadcastEncryptedShare()" style="margin-top:8px;">Broadcast</button></div></div>
            <div class="config-section"><div class="config-header"><span>Received Shares</span><span id="sign-share-count" style="color:#00d4ff;">0 received</span></div><div style="padding:12px;" id="sign-received-shares">No shares yet.</div><button class="btn" onclick="copyCollectedShares()" style="margin:12px;">Copy All Shares</button></div>
        </div>

        <!-- HD Tab -->
        <div id="hd-content" class="main-tab-content">
            <p class="subtitle">BIP-44 Hierarchical Deterministic Address Derivation</p>
            <div class="card"><div class="section-title">HD Derivation</div><p style="color:#aaa;">Generate unlimited Bitcoin addresses from your DKG wallet. Each party can derive addresses independently.</p></div>
            <div class="command-box"><code># List addresses&#10;frostdao dkg-list-addresses --count 10 --network testnet</code></div>
        </div>

        <!-- Reshare Tab -->
        <div id="reshare-content" class="main-tab-content">
            <p class="subtitle">Key Resharing - Change Threshold or Rotate Parties</p>
            <div class="card"><div class="section-title">What is Resharing?</div><p style="color:#aaa;">Create new shares for the same public key without exposing the secret. Add/remove parties or change threshold.</p></div>
            <div class="command-box"><code># Reshare round 1&#10;frostdao reshare-round1 --new-threshold 3 --new-n-parties 5</code></div>
        </div>

        <!-- Backup Tab -->
        <div id="backup-content" class="main-tab-content">
            <p class="subtitle">Mnemonic Backup & Recovery</p>
            <div class="card"><div class="section-title">Backup Your Share</div><p style="color:#aaa;">Convert your secret share to a BIP-39 mnemonic (24 words) for safe offline storage.</p></div>
            <div class="command-box"><code># Export as mnemonic&#10;frostdao export-mnemonic</code></div>
            <div class="warning">Never share your mnemonic! Store in a secure, offline location.</div>
        </div>

        <!-- Verify Tab -->
        <div id="verify-content" class="main-tab-content">
            <p class="subtitle">Verify Schnorr Signatures (BIP-340)</p>
            <div class="card">
                <div class="section-title">Signature Verification</div>
                <div class="form-group"><label>Public Key (hex, 32 bytes)</label><input type="text" id="verify-pubkey" placeholder="64 hex characters..."></div>
                <div class="form-group"><label>Message</label><input type="text" id="verify-message" placeholder="Original message..."></div>
                <div class="form-group"><label>Signature (hex, 64 bytes)</label><input type="text" id="verify-signature" placeholder="128 hex characters..."></div>
                <button class="btn btn-primary" onclick="verifySignature()">Verify</button>
                <button class="btn btn-secondary" onclick="clearVerifyForm()">Clear</button>
                <div id="verify-result" style="display:none;margin-top:20px;"></div>
            </div>
        </div>
    </div>

    <!-- Load modules -->
    <script type="module" src="js/main.js"></script>
    <script type="module" src="js/verify.js"></script>
</body>
</html>
